FYD project
2006.02.24



Скрипты базы данных:

/db/db.sql - создание MySQL базы данных fyd, MySQL аккаунта fyd:fyd21
/db/fyd.sql - создание таблиц
/db/values.sql - добавление начальных значений в базу данных





Структура директорий web-сервреа:


/admin/ - скрипты админа
	*.php
/email/ - темплейты писем
	*.mail
/geoip/
	GeoIPCity.dat - специальный файл ~20M (нужно добавить отдельно; он в этот пакет не входит)
/html/ - html темплейты
	/admin/ - html темплейты админа
		*.html
	/F/ - html темплейты залогиненого пользователя (муж. пола)
		*.html
	/M/ - html темплейты залогиненого пользователя (женск. пола)
		*.html
	/public/ - html темплейты не-залогиненого пользователя
		*.html
/img/ - статические картинки, стили, javascript файлы
	/admin/ - админа
		*.gif, *.jpg, *.css, *.js
	/F/ - залогиненого пользователя (муж. пола)
		*.gif, *.jpg, *.css, *.js
	/M/ - залогиненого пользователя (женск. пола)
		*.gif, *.jpg, *.css, *.js
	/public/ - не-залогиненого пользователя
		*.gif, *.jpg, *.css, *.js
/include/ - общие модули
	*.php
/lider/
	lider.pl - скрипт игры лидер, запускаемый по cron'у
/pics/ - фото файлы, закаченные пользователями
	*.jpg
	no.jpg
	no_l.jpg
	no_m.jpg
/video/ - видео файлы, закаченные пользователями
	*.avi, *.mpeg, *.mpg
/*.php - в корне лежат скрипты интерфейса пользователя




Инсталляция системы:

1) инсталляция таблиц базы данных с помощью fyd.sql или через web http://findyourdream.ru/fyd.php
2) инсталляция начальных значений с помощью values.sql или через web http://findyourdream.ru/values.php
3) установить рекурсивно директории/файлы web-сервера (скопировать)
4) установить параметры коннекта к базе данных (server,database,login,password) в файле /include/db.php:
	var $sHost = "localhost";
	var $sDB = "fyd";
	var $sLogin = "fyd";
	var $sPassword = "fyd21";
4) установить параметры системы в в файле /include/common.php:
	define("PICS_DIR", "/inetpub/wwwroot/fyd/pics/"); - директория для картинок пользователя
	define("VIDEO_DIR", "/inetpub/wwwroot/fyd/video/"); - директория для видео пользователя
	define("GEOIP_DIR", "/inetpub/wwwroot/fyd/geoip/"); - директория где лежит файл-база GeoIP
	define("INFO_EMAIL", "info@FindYourDream.ru"); - email от которого отсылаются письма
	define("SERVER_URL", "http://localhost/fyd/"); - URL корня сайта

	define("IMAGE_LOGO", "FindYourDream.ru"); - надпись на фото лидера (только на английском)
	define("IMAGE_LOGO_SIZE", "3"); - размер шрифта этой надписи от 0 до 5

	define("IMAGE_QUALITY", "80"); - качество фотографий пользователя

	define("IMAGE_BIG_X", "450"); - размеры большой версии фото пользователя
	define("IMAGE_BIG_Y", "600");
	define("IMAGE_LIDER_X", "209"); - размеры фото лидера
	define("IMAGE_LIDER_Y", "281");
	define("IMAGE_MEDIUM_X", "101"); - размеры фото второстепенного лидера
	define("IMAGE_MEDIUM_Y", "164");
	define("IMAGE_SMALL_X", "76"); - размер маленькой версии фото для списков
	define("IMAGE_SMALL_Y", "103");


	define("ADMIN_PASSWD", "fyd21"); - пароль админа

	define("MAX_HELLO", "20"); - max. длина игровой подписи пользователя

5) установить параметры коннекта к базе данных (server,database,login,password) в скрипте игры лидер /lider/lider.pl:
	my $db = DBI->connect("dbi:mysql:fyd;host=localhost", "fyd", "fyd21");

6) установить запуск скрипта /lider/lider.pl по cron'у с периодом равным игровому периоду,
	установленному в интерфейсе админа


http://findyourdream.ru/index.php - интерфейс пользователя

http://findyourdream.ru/admin/login.php - интерфейс админа




Интерфейс админа:

Редактирование пользователей: параметров пользователей, счетов, VIP/Обычный статус
	VIP пользователь имеет дополнительные опции поиска, возможность закачать видео ролики;
	VIP пользователи выделяются
Редактирование городов: Город,
	имя города в GeoIP базе,
	специальная игровая ставка для каждого города;
		если ставка = 0, то используется общая ставка для таких городов;
		по умолчанию используется общая для всех городов ставка
Редактирование наборов параметров: Интересы, Материальное положение, Цели знакомства, Проживание, Языки, Алкоголь, Курение
	у параметров есть поле: приоритет упорядочения знaчений в списке;
	кроме того параметры: Интересы, Цели знакомства и Языки могут иметь несколько значений одновременно;
	эти параметры имеют также поле маски, кот. должно быть уникальным
Настройки:
	Фото обязательно или нет
	Max. размер файла фото в Kилобайтах
	Max. размер файла видео Mегабайтах
	Max. кол-во файлов фото
	Max. кол-во файлов видео
	Тип лидера на главной странице: 
		По просмотрам, - чью анкету больше всего раз открывали
		По письмам, - кому посылали больше всего сообщений
		Игра лидер - лидер определяется по результатам игры лидер
	Кол-во лидеров общее на главной и показанных в игре (по умолчанию 4: 1 главный + 3 вторичных)
	Игровой период: (в минутах) снятия игровой ставки с играющих в данный момент игроков (не забудьте установить его в crontab'е)
	Игровая ставка:  (в баллах) снимается каждый игровой период; используется для всех городов, у кот. нет своей ставки (своя = 0)
	100 баллов:  стоимость 100 игровых баллов (в долларах)
	По просмотрам на главной: кол-во самых популярных анкет на главной; если 0, то вообще не выводить эту область
	Новые на главной: кол-во самых последних активированных (новых) людей на главной; если 0, то вообще не выводить эту область
	По сообщениям на главной: кол-во самых популярных (больше всего сообщений) людей на главной; если 0, то вообще не выводить эту область



Игра лидер:

Каждый пользователь может играть.
Играть в пределах своего города.
У каждого города своя игра и может быть своя игровая ставка или общая.
Пользователь покупает себе баллы на деньги со счета.
Сейчас счет каждого пользователя задается в админе.
После этого пользователь может делать игровую ставку нек. кол-во баллов.
лидирует тот, у кого суммарная ставка больше.
с каждым игровым периодом ставка кадого пользователя уменьшается на игровую цену (у кажд. города может быть своя).
после игры лидером остается последний оставшийся в лидерах.
на игровой странице расположены фото пользователей и отностиельные диаграммы первых 4-х (кол-во задается в админе) игроков.
кроме того виден относительный вес каждого игрока.
на главной странице есть отображение лидеров (главного и второстепенных)
если кто-то в данный момент играет, то на главной выводятся из фотки, если никто не играет то выводятся последние лидеры, кот. играли.
если вообще нет никого, то выводятся или общие для всех городов лидеры или вообще просто популярные люди, если вообще никаких лидеров нет.
в любом случае место лидера на главной пусто не бывает ;-)


На главной странице можно организовать (настраивается в админе) до 3-х (1,2,3 или ни одной) специальных областей-списков:
	новые люди, популярные по просмотрам анкет, популярные по получаемым сообщениям





HTML темплейты:

имеюрасширение .html для страниц сайта или их частей и .mail для отправляемых сообщений.
представляют из себя HTML контент.

темплейты имеют:
	статический текст: простой текст и тэги HTML
	блоки : <!-- begin_alcohol_bHeadNew -->Новая запись<!-- end_alcohol_bHeadNew -->
		<!-- begin_alcohol_bHeadNew --> - отмечает начало блока 'alcohol_bHeadNew'
		<!-- end_alcohol_bHeadNew --> - отмечает конец блока 'alcohol_bHeadNew'
	теги : {params} - в фигурных скобках имя параметра

теги и блоки могут быть вложены в другие блоки.
вместо тегов движок подставляет конкретные значения или пустые строки по смыслу.
блоки могут быть движком разпарсены и размножены если надо или вообще убраны по смыслу.
менять расположение блоков, тегов и текста можно как угодно,
но нельзя изменять структуру вложенности.
отдельные формы и списки имеют свои отдельные блоки.
элементы форм и списков имеют свои под-блоки.

Есть 4 отдельных области, для каждой из которых отдельно настраивается весь дизайн:
	public - общая для не-залогиненых пользователей
	M - залогиненные парни
	F - залогиненные девушки
	admin - интерфейс админа
также каждая из четырех областей имеет по директории для хранения картинок, javascript файлов внешних, и стилей
подключается это через тег {images}
например, <img src="{images}1.jpg"> или <link rel="stylesheet" type="text/css" href="{images}fyd.css">
в каждый header уже подключен соответствующий fyd.css файл стилей.

Есть несколько специальных темплейтов:
	header.html - шапка для всех страниц
	footer.html - концовка для всех страниц
	searchlist.html - список найденных пользователей; результаты поиска
	searchSimple.html - простая форма поиска
	searchVIP.html - расширенная форма поиска; для VIP'ов
Это не темплейты отдельных страниц, а элементы, кот. могут быть включены в другие страницы.
Тоесть подставлены вместо какого-то тега.
Например на всех страницах подставляется уже подготовленный (разпарсенный) header.html вместо {iHeader}
и footer.html вместо {iFooter}.

2 темплейта писем:
	forgot.mail - для писем напоминания забытого пароля
	register.mail - для писем подтверждения регистрации
В них ссылки на картинки должны быть абсолютными.

При создании страниц дизайнеру лучше всего пользоваться или движком,
чтобы сразу видет как будет реально выглядеть в результате страница.

Или просто создать поддиректорию {images} рядом с html темплейтами и хранить там картинки
и верстать страницы сначала полностью, не разбивая на отдельные включаемые файлы как header и footer.
А потом просто скопировать в соответствующую директории движка картинки и разделить html файлы на части.




Списки top10, new10, view10 на главной разбиты в две колонки.

На главной странице index.html и home.html есть 3 блока для 3-х сложных списков.
Каждый список разбивается на 2 колонки.
Тоесть есть общая таблица у которой 2 ячейки.
В каждую ячейку вставляется таблица с половиной списка.
А первую ячейку первая половина и во второю - вторая.
	<!-- begin_top10 -->
	<table border="0"><tr><td valign="top"><table border="0">
	<!-- begin_top10_item --><tr><td>
	<a href="view.php?userId={userId}&{params}"><img src="pics/{img}" border="0"></a>
	</td><td>
	<!-- begin_top10_vip -->VIP<!-- end_top10_vip -->
	<!-- begin_top10_novip -->Обычный<!-- end_top10_novip -->
	<br>
	<a href="view.php?userId={userId}&{params}">{login}</a>, {age}<br>{city}<br>{sex} ищет: {lookSex}
	<br>
	<i>{about}</i>
	</td></tr>
	<!-- begin_top10_middle -->
	</table></td><td valign="top"><table border="0">
	<!-- end_top10_middle -->
	<!-- end_top10_item -->
	</table></td></tr></table>
	<!-- end_top10 -->

Есть специальный блок:
	<!-- begin_top10_middle -->
	</table></td><td valign="top"><table border="0">
	<!-- end_top10_middle -->
Этот блок вставляется в результирующую страницу 1 раз.
Он заканчивает первую внутреннюю таблицу и первую ячейку и начинает второю ячейку и внутреннюю таблицу.


